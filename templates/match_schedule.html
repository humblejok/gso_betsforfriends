{% load socialaccount %}
<!DOCTYPE html>
<html lang="en">
	<head>
		<title>Editer la planification des matchs</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
		<link href="/static/bootstrap/css/bootstrap.min.css" rel="stylesheet"/>
		<link href="/static/jquery.timepicker.css" rel="stylesheet" type="text/css"/>
		<link href="/static/themes/redmond/jquery-ui.min.css" rel="stylesheet" type="text/css"/>
		<script src="/static/jquery-2.1.0.min.js" type="text/javascript"></script>
		<script src="/static/jquery-ui.js" type="text/javascript"></script>
		<script src="/static/jquery.timepicker.js" type="text/javascript"></script>
		<script src="/static/bootstrap/js/bootstrap.min.js"></script>
		<script src="/static/gammasimos.js"></script>
		<script src="/static/date.js" type="text/javascript"></script>
		<script>

			$(document).ready(function () {
		     	$(".btn").tooltip();
				$(".no-enter").keydown( function(e) {
					if (e.keyCode == 13) {
						e.preventDefault();
					}
				});
				$(".date-field").datepicker({ dateFormat: "yy-mm-dd" });
				$('.time-field').timepicker({ timeFormat: "H:i"});
				csrftoken = getCookie('csrftoken');
			});

			function dateOrTimeChanged(match_id) {
				$("#save_" + match_id).removeClass("invisible");
			}

			function matchsNotSaved(e) {
				alert("An error occured while saving [" + e.message + "].");
			}

			function matchsSaved(e) {
				if (e.result) {
					document.getElementById( "matchsForm" ).reset();
					location.reload();
				} else {
					betsNotSaved(e);
				}
			}

			function saveOneMatch(match_id) {
				var date_val = $("#date_" + match_id).val();
				var time_val = $("#time_" + match_id).val();
				var updateForm = new FormData();
				updateForm.append('new_date', date_val);
				updateForm.append('new_time', time_val);
				updateForm.append('match_id', match_id);
				$.ajax({
					url: '/matchs_schedule_update.html',
					type: 'POST',
					data: updateForm,
					processData: false,
					contentType: false,
					success: matchsSaved,
					error: matchsNotSaved
				});
			}
		</script>
	</head>
	<body>
		<div class="container" style="padding: 0 15px;">
			{% if request.user.is_authenticated and request.user.is_superuser %}
				<form id="matchsForm">
					<div class="row">
						<div class="col-lg-10">
							<h1 class="">Editer la planification</h1>
				  			<p class="lead">C'est par ici pour changer les jours et horaires des matchs.

						</div>
						
						<a href="/matchs_generate.html" class="btn btn-default" role="button" data-toggle="tooltip" data-placement="bottom" title="Générer les templates">
							<span class="glyphicon glyphicon glyphicon-repeat"></span>
						</a>
						<a href="/matchs_compute.html" class="btn btn-default" role="button" data-toggle="tooltip" data-placement="bottom" title="Calculer les scores">
							<span class="glyphicon glyphicon-refresh"></span>
						</a>
						<a href="/index.html" class="btn btn-default" role="button" data-toggle="tooltip" data-placement="bottom" title="Retour à l'index">
							<span class="glyphicon glyphicon-home"></span>
						</a>
						<a href="/accounts/logout" class="btn btn-default" role="button" data-toggle="tooltip" data-placement="bottom" title="Quitter">
							<span class="glyphicon glyphicon-off"></span>
						</a>
					</div>
					<div class="row">&nbsp;</div>
					<div class="row" id="eventTableDiv">
						<table class="table col-lg-12">
							<tr><th>Match</th><th>Premier participant</th><th>Deuxième participant</th><th>Date</th><th>Heure</th><th>Action</th></tr>
							{% for match in all_matchs %}
								<tr id="{{match.id}}">
									<td>{{match.name}}</td>
									<td>{{match.first.name}}</td>
									<td>{{match.second.name}}</td>
									<td><input id="date_{{match.id}}" value="{{match.when|date:'Y-m-d'}}" class="form-control no-enter text-center date-field" onchange="dateOrTimeChanged({{match.id}})"/></td>
									<td><input id="time_{{match.id}}" value="{{match.when|date:'H:i'}}" class="form-control no-enter text-center time-field" onchange="dateOrTimeChanged({{match.id}})"/></td>
									<td><button id="save_{{match.id}}" type="button" class="btn btn-info btn-sm invisible" onclick="saveOneMatch({{match.id}})">Sauvegarder</button></td>
								</tr>
							{% endfor %}
						</table>
					</div>
				</form>
			{% else %}
				<div class="row">
					<div class="col-lg-11">
						<h1 class="">Oups!</h1>
			  			<p class="lead">Vous n'auriez jamais dû arriver sur cette page.
			  			<p class="lead">Merci de revenir à l'<a href="/index.html">acceuil</a> ou de vous authentifier.
					</div>
				</div>

				<div class="row text-center">
		    		<a href="/accounts/login" class="btn btn-primary btn-lg" role="button">Login</a>
		    	</div>
		    	<div style="height: 400px;">&nbsp;</div>
		    	<div class="row h6">Ce site utilise des icônes en provenance de <a href="http://glyphicons.com/">GlyphIcons</a></div>
			{% endif %}
		</div>

	</body>